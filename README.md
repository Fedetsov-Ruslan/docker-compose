# sender-server
> Конфигурация Docker Compose для Telegram бота с FastAPI, PostgreSQL, Redis, Nginx и Certbot

## Сервисы
- bot: Сервис Telegram бота, использующий Aiogram.
- fastapi: Сервис бэкенда, использующий FastAPI.
- db: Сервис базы данных PostgreSQL.
- redis: Сервис Redis для хранения состояний.
- nginx: Сервис веб-сервера Nginx.
- certbot: Сервис Certbot для SSL-сертификатов.

## описание работы прилажения
С помощью функции test_post, с post запроса получаем json, представляем его ввиде class Message. Получаем message, ввиде текстового сообщения

текстовое сообщение попадает в функцию "process_message_from_user".

Внутри функции из базы данных получаем из базы данных id пользователя которому хотим отправить наше сообщение и отправляем

## описание docker-compose
1) .env.docker - для хранения конфиденциальных данных (имя базы данных, логины, парали, токены телеграммаб url)

2) depends_on - указывает какие сервисы должны запуститься до запуска контейнера

3) ports - host и контейнер порты, по которым будут доступны сервисы

4) networks - подключает все сервисы к одной сети, что упрощает межконтейнерное взаимодействие

5) command - команда для запуска сервиса, со скриптом wait-for-it.sh чтобы убедиться что сервис указанный в depends_on запущен

6) entrypoint - указание исполняемого файла

7) volumes - тома для сохранения и управления данными

## инициализация окружения 

1) Убедитесь, что создан файл
```bash 
.env.docker 
```
в директориях bot и fastapi и в них нахотятся переменные с (имя базы данных, логины, парали, токены телеграммаб url)

2) Настройка Nginx: Обновите файл nginx/nginx.conf с вашей специфической конфигурацией сервера.

3) создаем мост для сервисов
```bash
docker network create -d bridge tg-bot
```

4) собираем и запускам сервисы 
```bash
docker-compose up --build
```
## .env

1) TOKEN=токен телеграмм бота

2) NGINX_HOST = 'your_domain.com'